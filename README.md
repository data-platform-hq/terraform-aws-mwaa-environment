# terraform-aws-mwaa-environment
# AWS MWAA environment Terraform module
Terraform module for AWS MWAA environment creation

## Usage

```hcl
module "kinesis_firehouse" {
  source  = "data-platform-hq/mwaa-environment/aws"
  version = "~> 1.0"
  
  tags = {
    ENV : "Development"
  }

  name               = "mwaa-env1"
  source_bucket_arn  = "arn:aws:s3:::bucket1"
  dag_s3_path        = "dags/"
  execution_role_arn = "arn:aws:iam::123456789123:role/role1"
  subnet_ids         = ["subnet-12345678", "subnet-87654321"]
  min_workers        = 1
  max_workers        = 3
  public_environment = true
  all_logs_enabled   = true
}
```


<!-- BEGIN_TF_DOCS -->
## Requirements

| Name                                                                        | Version  |
|-----------------------------------------------------------------------------|----------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform)   | >= 1.0   |
| <a name="requirement_aws"></a> [aws](#requirement\_aws)                     | >= 5.1.0 |

## Providers

| Name                                                | Version  |
|-----------------------------------------------------|----------|
| <a name="provider_aws"></a> [aws](#provider\_aws)   | >= 5.1.0 |

##[README.md](README.md) Modules

No modules.

## Resources

| Name                                                                                                                              | Type        |
|-----------------------------------------------------------------------------------------------------------------------------------|-------------|
| [aws_mwaa_environment.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mwaa_environment)         | resource    |
| [aws_subnetaws_subnet.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/subnet)                | data source |
| [aws_security_group.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group)             | resource    |
| [aws_security_group_rule.this.*](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule) | resource    |

## Inputs

| Name                                                                                                                                       | Description                                                                                                                                                | Type                                                                                                                                                                                                                                                                                                | Default | Required |
|--------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|:--------:|
| <a name="input_create"></a> [create](#input\_create)                                                                                       | Controls if resources should be created (affects nearly all resources)                                                                                     | `bool`                                                                                                                                                                                                                                                                                              | `true`  |    no    |
| <a name="input_tags"></a> [tags](#input\_tags)                                                                                             | A map of tags to add to all resources                                                                                                                      | `map(string)`                                                                                                                                                                                                                                                                                       | `{}`    |    no    |
| <a name="input_name"></a> [name](#input\_name)                                                                                             | The name of the Apache Airflow Environment                                                                                                                 | `string`                                                                                                                                                                                                                                                                                            | n/a     |   yes    |
| <a name="input_source_bucket_arn"></a> [source\_bucket\_arn](#input\_source\_bucket\_arn)                                                  | The Amazon Resource Name (ARN) of your Amazon S3 storage bucket                                                                                            | `string`                                                                                                                                                                                                                                                                                            | n/a     |   yes    |
| <a name="input_dag_s3_path"></a> [dag\_s3\_path](#input\_dag\_s3\_path)                                                                    | The relative path to the DAG folder on your Amazon S3 storage bucket                                                                                       | `string`                                                                                                                                                                                                                                                                                            | n/a     |   yes    |
| <a name="input_execution_role_arn"></a> [execution\_role\_arn](#input\_execution\_role\_arn)                                               | The Amazon Resource Name (ARN) of the task execution role that the Amazon MWAA and its environment can assume                                              | `string`                                                                                                                                                                                                                                                                                            | n/a     |   yes    |
| <a name="input_subnet_ids"></a> [subnet\_ids](#input\_subnet\_ids)                                                                         | The private subnet IDs in which the environment should be created. MWAA requires two subnets                                                               | `list(string)`                                                                                                                                                                                                                                                                                      | n/a     |   yes    |
| <a name="input_additional_security_group_ids"></a> [additional\_security\_group\_ids](#input\_additional\_security\_group\_ids)            | Additional security groups to attach                                                                                                                       | `list(string)`                                                                                                                                                                                                                                                                                      | `[]`    |    no    |
| <a name="input_airflow_configuration_options"></a> [airflow\_configuration\_options](#input\_airflow\_configuration\_options)              | The airflow_configuration_options parameter specifies airflow override options                                                                             | `map(string)`                                                                                                                                                                                                                                                                                       | `{}`    |    no    |
| <a name="input_airflow_version"></a> [airflow\_version](#input\_airflow\_version)                                                          | Airflow version of your environment                                                                                                                        | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_environment_class"></a> [environment\_class](#input\_environment\_class)                                                    | Environment class for the cluster. Possible options are mw1.small, mw1.medium, mw1.large                                                                   | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_kms_key"></a> [kms\_key](#input\_kms\_key)                                                                                  | The Amazon Resource Name (ARN) of your KMS key that you want to use for encryption                                                                         | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_min_workers"></a> [min\_workers](#input\_min\_workers)                                                                      | The minimum number of workers that you want to run in your environment                                                                                     | `number`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_max_workers"></a> [max\_workers](#input\_max\_workers)                                                                      | The maximum number of workers that can be automatically scaled up                                                                                          | `number`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_plugins_s3_path"></a> [plugins\_s3\_path](#input\_plugins\_s3\_path)                                                        | The relative path to the plugins.zip file on your Amazon S3 storage bucket                                                                                 | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_plugins_s3_object_version"></a> [plugins\_s3\_object\_version](#input\_plugins\_s3\_object\_version)                        | The plugins.zip file version you want to use                                                                                                               | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_requirements_s3_path"></a> [requirements\_s3\_path](#input\_requirements\_s3\_path)                                         | The relative path to the requirements.txt file on your Amazon S3 storage bucket                                                                            | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_requirements_s3_object_version"></a> [requirements\_s3\_object\_version](#input\_requirements\_s3\_object\_version)         | The requirements.txt file version you want to use                                                                                                          | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_startup_script_s3_path"></a> [startup\_script\_s3\_path](#input\_startup\_script\_s3\_path)                                 | The relative path to the script hosted in your bucket                                                                                                      | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_startup_script_s3_object_version"></a> [startup\_script\_s3\_object\_version](#input\_startup\_script\_s3\_object\_version) | The version of the startup shell script you want to use                                                                                                    | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_schedulers"></a> [schedulers](#input\_schedulers)                                                                           | The number of schedulers that you want to run in your environment                                                                                          | `number`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_public_environment"></a> [public\_environment](#input\_public\_environment)                                                 | Whether the webserver should be accessible over the internet                                                                                               | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_weekly_maintenance_window_start"></a> [weekly\_maintenance\_window\_start](#input\_weekly\_maintenance\_window\_start)      | Specifies the start date for the weekly maintenance window                                                                                                 | `string`                                                                                                                                                                                                                                                                                            | `null`  |    no    |
| <a name="input_all_logs_enabled"></a> [all\_logs\_enabled](#input\_all\_logs\_enabled)                                                     | Whether to enable all logs (DAG processing, Scheduler, Task, Webserver, Worker)                                                                            | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_all_logs_log_level"></a> [all\_logs\_log\_level](#input\_all\_logs\_log\_level)                                             | Logging level. Valid values: CRITICAL, ERROR, WARNING, INFO, DEBUG                                                                                         | `string`                                                                                                                                                                                                                                                                                            | `INFO`  |    no    |
| <a name="input_dag_processing_logs_enabled"></a> [dag\_processing\_logs\_enabled](#input\_dag\_processing\_logs\_enabled)                  | Whether to enable DAGs processing logs. Specify if some of logs should be enabled. Otherwise - use all_logs_enabled variable                               | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_dag_processing_logs_log_level"></a> [dag\_processing\_logs\_log\_level](#input\_dag\_processing\_logs\_log\_level)          | Logging level. Valid values: CRITICAL, ERROR, WARNING, INFO, DEBUG. Specify if some of logs should be enabled. Otherwise - use all_logs_log_level variable | `string`                                                                                                                                                                                                                                                                                            | `INFO`  |    no    |
| <a name="input_scheduler_logs_enabled"></a> [scheduler\_logs\_enabled](#input\_scheduler\_logs\_enabled)                                   | Whether to enable Scheduler logs. Specify if some of logs should be enabled. Otherwise - use all_logs_enabled variable                                     | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_scheduler_logs_log_level"></a> [scheduler\_logs\_log\_level](#input\_scheduler\_logs\_log\_level)                           | Logging level. Valid values: CRITICAL, ERROR, WARNING, INFO, DEBUG. Specify if some of logs should be enabled. Otherwise - use all_logs_log_level variable | `string`                                                                                                                                                                                                                                                                                            | `INFO`  |    no    |
| <a name="input_task_logs_enabled"></a> [task\_logs\_enabled](#input\_task\_logs\_enabled)                                                  | Whether to enable Task logs. Specify if some of logs should be enabled. Otherwise - use all_logs_enabled variable                                          | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_task_logs_log_level"></a> [task\_logs\_log\_level](#input\_task\_logs\_log\_level)                                          | Logging level. Valid values: CRITICAL, ERROR, WARNING, INFO, DEBUG. Specify if some of logs should be enabled. Otherwise - use all_logs_log_level variable | `string`                                                                                                                                                                                                                                                                                            | `INFO`  |    no    |
| <a name="input_webserver_logs_enabled"></a> [webserver\_logs\_enabled](#input\_webserver\_logs\_enabled)                                   | Whether to enable Webserver logs. Specify if some of logs should be enabled. Otherwise - use all_logs_enabled variable                                     | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_webserver_logs_log_level"></a> [webserver\_logs\_log\_level](#input\_webserver\_logs\_log\_level)                           | Logging level. Valid values: CRITICAL, ERROR, WARNING, INFO, DEBUG. Specify if some of logs should be enabled. Otherwise - use all_logs_log_level variable | `string`                                                                                                                                                                                                                                                                                            | `INFO`  |    no    |
| <a name="input_worker_logs_enabled"></a> [worker\_logs\_enabled](#input\_worker\_logs\_enabled)                                            | Whether to enable Worker logs. Specify if some of logs should be enabled. Otherwise - use all_logs_enabled variable                                        | `bool`                                                                                                                                                                                                                                                                                              | `false` |    no    |
| <a name="input_worker_logs_log_level"></a> [worker\_logs\_log\_level](#input\_worker\_logs\_log\_level)                                    | Logging level. Valid values: CRITICAL, ERROR, WARNING, INFO, DEBUG. Specify if some of logs should be enabled. Otherwise - use all_logs_log_level variable | `string`                                                                                                                                                                                                                                                                                            | `INFO`  |    no    |

## Outputs

| Name                                                                          | Description                               |
|-------------------------------------------------------------------------------|-------------------------------------------|
| <a name="output_arn"></a> [arn](#output\_arn)                                 | The ARN of the MWAA Environment           |
| <a name="output_webserver_url"></a> [webserver\_url](#output\_webserver\_url) | The webserver URL of the MWAA Environment |

<!-- END_TF_DOCS -->

## License

Apache 2 Licensed. For more information please see [LICENSE](https://github.com/data-platform-hq/terraform-azurerm-linux-web-app/tree/main/LICENSE)
